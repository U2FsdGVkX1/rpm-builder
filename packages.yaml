# macros in order fedora srpm compile
- name: redhat-rpm-config # we need to compile annobin
  nobuild: true
  url: https://koji.fedoraproject.org/koji/buildinfo?buildID=2161211
  install: [redhat-rpm-config]
  post:
    - ln -sf redhat /usr/lib/rpm/$(rpm --eval '%_host_vendor')
    - sed -i 's/^%_enable_debug_packages/#%_enable_debug_packages/' /usr/lib/rpm/redhat/macros
    - sed -i 's/^%__brp_check_rpaths/#%__brp_check_rpaths/' /usr/lib/rpm/redhat/macros
    - echo gcc > $(gcc --print-file-name=)/rpmver
- name: multilib-rpm-config
  nobuild: true
  install: [multilib-rpm-config]
- name: fedora-release
  nobuild: true
  url: https://koji.fedoraproject.org/koji/buildinfo?buildID=2207533
  install: [fedora-release-common]
- name: systemd
  nobuild: true
  install: [systemd-rpm-macros]
- name: rust-packaging
  nobuild: true
  install: [rust-srpm-macros]
- name: python-rpm-macros
  nobuild: true
  install: [python-rpm-macros, python3-rpm-macros, python-srpm-macros]
- name: python-rpmautospec
  nobuild: true
  install: [rpmautospec-rpm-macros]
- name: perl
  nobuild: true
  install: [perl-macros]
- name: perl-srpm-macros
  nobuild: true
  install: [perl-srpm-macros]
- name: perl-Fedora-VSP # for perl on fedora
  nobuild: true
  install: [perl-Fedora-VSP]

# autotool
- name: autoconf
  nobuild: true
  install: [autoconf]
- name: automake
  nobuild: true
  install: [automake]

# nano
- name: ncurses
  install: [ncurses, ncurses-devel, ncurses-libs, ncurses-base]
  define:
    gpgverify: "#"
- name: nano
  install: [nano]
  define:
    gpgverify: "#"

# annobin
- name: libtool # for gmp
  undefine: [_annotated_build]
  install: [libtool, libtool-ltdl, libtool-ltdl-devel]
- name: gmp # for annobin
  without: [fips]
  undefine: [_annotated_build]
  install: [gmp, gmp-devel]
- name: annobin
  url: https://koji.fedoraproject.org/koji/buildinfo?buildID=2209223
  without: [tests, annocheck, clangplugin, llvmplugin]
  install: [annobin-plugin-gcc]
  define:
    _unpackaged_files_terminate_build:

# gpg
- name: libassuan # for libksba
  install: [libassuan, libassuan-devel]
- name: libksba # for npth
  with: [bootstrap]
  install: [libksba, libksba-devel]
- name: npth # for gnupg2
  install: [npth, npth-devel]
  define:
    gpgverify: "#"
- name: gnupg2
  with: [bootstrap]
  install: [gnupg2]
  patch:
    - sed -r -i '/dirmngr(-client)?$/d' %SPEC # we don't have gnutls

# ---------------------------------------------------------------------

# cmake
- name: vim # for cmake
  nobuild: true
  install: [vim-filesystem]
- name: cmake
  with: [bootstrap]
  without: [emacs, git_test, gui, sphinx, test, X11_test]
  install: [cmake, cmake-data, cmake-rpm-macros]
  define:
    _unpackaged_files_terminate_build:

# ruby
- name: libyaml # for ruby
  install: [libyaml, libyaml-devel]
- name: readline # for ruby
  install: [readline, readline-devel]
- name: ruby # will error in qemu user mode
  without: [rubypick, systemtap, hardening_test, yjit]
  install: [ruby, ruby-devel, rubygems]

# libselinux
- name: bison # for flex
  install: [bison]
- name: flex # for libsepol
  install: [flex, libfl, libfl-devel]
- name: pcre2 # for libsepol
  url: https://koji.fedoraproject.org/koji/buildinfo?buildID=2122857
  install: [pcre2, pcre2-devel]
- name: libsepol # for libselinux
  install: [libsepol, libsepol-devel, libsepol-static]

- name: dos2unix # for swig
  install: [dos2unix]
- name: swig # for libselinux
  without: [testsuite]
  install: [swig]

- name: libselinux
  install: [libselinux, libselinux-devel]

# texinfo for gnutls and elfutils
- name: perl-generators # for texinfo
  nobuild: true
  install: [perl-generators]
- name: perl-Text-Unidecode # for texinfo
  nobuild: true
  install: [perl-Text-Unidecode]
- name: perl-Unicode-EastAsianWidth # for texinfo
  nobuild: true
  install: [perl-Unicode-EastAsianWidth]
- name: perl-libintl-perl # for texinfo
  install: [perl-libintl-perl]
- name: texinfo
  install: [texinfo]

# gnutls for libmicrohttpd in elfutils
- name: meson # for p11-kit
  nobuild: true
  install: [meson]
- name: bash-completion # for p11-kit
  nobuild: true
  install: [bash-completion]
- name: ninja-build # for p11-kit
  with: [bootstrap]
  install: [ninja-build]
- name: libtasn1 # for p11-kit
  install: [libtasn1, libtasn1-devel, libtasn1-tools]
  patch:
    - sed -i '/^autoreconf/d' %SPEC # we don't have gtk-doc
- name: p11-kit # for gnutls
  install: [p11-kit, p11-kit-devel]
  define:
    __meson_auto_features: auto # we don't have systemd
  patch:
    - sed -i 's/gtk_doc=true/gtk_doc=false/' %SPEC # we don't have gtk-doc
    - sed -i 's/man=true/man=false/' %SPEC # we don't have docbook
    - sed -i '/p11-kit-remote/,/bash-completion/{//!d;}' %SPEC
    - sed -i '/p11-kit-server$/,/^$/{//!d;}' %SPEC
    - sed -i '/\/gtk-doc\/$/d' %SPEC

- name: nettle # for gnutls
  without: [fips]
  install: [nettle, nettle-devel]
- name: libunistring # for gnutls
  install: [libunistring, libunistring-devel]

- name: gnutls
  without: [bootstrap, dane, fips, tpm2, gost, tests, srp, mingw]
  install: [gnutls, gnutls-devel]

# elfutils
- name: doxygen # for libmicrohttpd
  install: [doxygen]
  define:
    fedora:
    _module_build: 1
- name: libmicrohttpd # for elfutils
  install: [libmicrohttpd, libmicrohttpd-devel]
- name: elfutils
  install: [elfutils, elfutils-devel, elfutils-libs, elfutils-libelf, elfutils-libelf-devel]

# docbook for glib and chkconfig
- name: sgml-common # MUST! otherwise there will be many problems
  nobuild: true
  install: [sgml-common, xml-common]

- name: opensp # for openjade
  install: [opensp, opensp-devel]
  define:
    _module_build: 1
- name: openjade # for docbook-utils
  install: [openjade]
- name: which # for docbook-utils
  install: [which]
- name: lynx # for docbook-utils
  url: https://koji.fedoraproject.org/koji/buildinfo?buildID=2195676
  install: [lynx]
- name: docbook-style-dsssl # for docbook-utils
  nobuild: true
  install: [docbook-style-dsssl]
- name: docbook-dtds # for docbook-utils
  nobuild: true
  install: [docbook-dtds]
- name: docbook-utils # for newt
  nobuild: true
  install: [docbook-utils]

- name: docbook-style-xsl # for xmlto
  nobuild: true
  install: [docbook-xsl]
- name: libxslt # for xmlto
  install: [libxslt, libxslt-devel]
- name: xmlto # for nss
  install: [xmlto]

# glib
- name: nss # for systemtap
  without: [tests]
  install: [nss, nss-devel]
  patch:
    - sed -i 's/\/configure/\/configure --build=%{_build}/' %SPEC # It doesn't use the configure macro
- name: cpio # for systemtap
  install: [cpio]
- name: systemtap # for glib2
  install: [systemtap]
  define:
    fedora:
    with_python3: 1
    with_python2_probes: 0
    with_python3_probes: 1

- name: glib2
  install: [glib2, glib2-devel]

# chkconfig for groff
- name: libpng # for slang
  install: [libpng, libpng-devel]
- name: slang # for newt
  without: [oniguruma]
  install: [slang, slang-devel]
- name: newt # for chkconfig
  install: [newt, newt-devel]
- name: chkconfig
  install: [alternatives]
  patch:
    - sed -r -i '/systemd-sysv-install$/d' %SPEC # we don't have systemd
  define:
    _unpackaged_files_terminate_build:

# openldap for krb5
- name: libevent # for openldap
  install: [libevent, libevent-devel]
- name: groff # for openldap
  install: [groff, groff-base]
  define:
    with_x: 0
    _unpackaged_files_terminate_build:
  patch:
    - sed -r -i '/mom-pdf\.pdf$/d' %SPEC # we don't have ghostscript
    - sed -r -i '/\/pdf\/$/d' %SPEC
  post:
    - ln -sf soelim.groff /usr/bin/soelim
- name: cyrus-sasl # openldap
  install: [cyrus-sasl, cyrus-sasl-devel, cyrus-sasl-lib]
  patch:
    - sed -r -i 's/bootstrap_cyrus_sasl 0$/bootstrap_cyrus_sasl 1/' %SPEC # enable bootstrap
    - sed -i '/Find Kerberos/,/^CFLAGS=/{//!d;}' %SPEC # remove krb5 and mysql postgresql dependency
    - sed -i 's/--with-mysql=yes --with-pgsql=yes/--without-mysql --without-pgsql/' %SPEC
    - sed -i 's/--without-sqlite/--with-sqlite3=\/usr/' %SPEC

    - sed -i '/cyrusbdb2current$/d' %SPEC
    - sed -i '/\*sasldb\*.so\*/d' %SPEC
    - sed -i '/saslpasswd2/d' %SPEC
    - sed -i '/sasldblistusers2/d' %SPEC
    - sed -i '/\*gssapi\*.so\*/d' %SPEC
    - sed -i '/libgs2.so\*/d' %SPEC
- name: cracklib # for openldap
  install: [cracklib, cracklib-devel]

- name: openldap
  install: [openldap, openldap-devel]

# e2fsprogs for krb5
- name: fuse # for e2fsprogs
  install: [fuse, fuse-devel, fuse-libs]
- name: e2fsprogs
  install: [libcom_err, libcom_err-devel, libss, libss-devel]
  define:
    _unpackaged_files_terminate_build:
  patch:
    - sed -r -i '/%files -n e2scrub/,/^$/d' %SPEC # we don't have systemd

# pam
- name: tcl # for krb5
  install: [tcl, tcl-devel]
- name: lmdb # for krb5
  install: [lmdb, lmdb-devel, lmdb-libs]
- name: libverto # for krb5
  install: [libverto, libverto-devel]
- name: krb5 # for elinks
  install: [krb5, krb5-devel]
- name: elinks # for pam
  install: [elinks]

- name: libxml2 # for docbook5
  install: [libxml2, libxml2-devel]
- name: docbook5-schemas # for pam
  nobuild: true
  install: [docbook5-schemas]
- name: docbook5-style-xsl # for pam
  nobuild: true
  install: [docbook5-style-xsl]

- name: pam # bug in 1.5.2
  url: https://koji.fedoraproject.org/koji/buildinfo?buildID=2206209
  install: [pam, pam-devel]